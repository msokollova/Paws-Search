{% extends 'base.html' %}
{% load static %}
{% block content %}

    <h2 class="w3-center w3-text-blue-gray">Направи дарение</h2>

    {% if user.is_authenticated %}
        <div class="w3-margin-top">
        <form action="{% url 'submit_testimonial' %}" method="post">
            {% csrf_token %}
            <div class="w3-center">
                <label for="testimonial" class="w3-large">Ако и Вие искате да публикуваме обява за дарение, моля
                    свържете се с нас:</label>
                <input type="text" name="testimonial" id="testimonial" class="w3-input w3-border w3-round-large"
                       style="margin-top: 10px" placeholder="Вашата кауза...">
                <button type="submit"
                        class="w3-button w3-round-large w3-teal w3-text-light-grey w3-hover-text-black w3-hover-teal w3-margin-top">
                    Изпрати
                </button>
            </div>
        </form>
    {% else %}
        <p>Ако и Вие искате да искате да публикуваме обява за дарение, моля <a href="{% url 'login' %}">влезте</a> в
            профила си.</p>
    {% endif %}

    {% if user.is_staff %}
        <div class="w3-right w3-margin">
            <a href="{% url 'add donation' %}"
               class="w3-button w3-round-large w3-cyan w3-text-light-grey w3-hover-text-black w3-hover-cyan">Добави</a>
        </div>
    {% endif %}

    <!-- Filter Form -->
    <form method="get" class="w3-row-padding w3-margin-bottom">
        <div class="w3-half">
            <label for="organizer">Organizer Type</label>
            <select name="organizer" id="organizer" class="w3-select">
                <option value="">Всички</option>
                {% for code, name in organizer_choices %}
                    <option value="{{ code }}" {% if code == current_organizer %}selected{% endif %}>{{ name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="w3-half">
            <label for="status">Status</label>
            <select name="status" id="status" class="w3-select">
                <option value="">Всички</option>
                {% for code, name in status_choices %}
                    <option value="{{ code }}" {% if code == current_status %}selected{% endif %}>{{ name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="w3-center w3-margin-top">
            <button type="submit"
                    class="w3-button w3-round-large w3-blue-gray w3-text-light-grey w3-hover-text-black w3-hover-blue-gray w3-margin-top">
                Търси
            </button>
        </div>
    </form>

    <!-- Donation List -->
    {% if donations %}
        <div class=" w3-margin-top"
             style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; align-items: start;">
            {% for donation in donations %}
                <div class="w3-card w3-hover-shadow" style="display: flex; flex-direction: column; height: 100%;">
                    <div class="w3-container">
                        <h3>{{ donation.title }}</h3>
                        <p><strong>Огранизатор:</strong> {{ donation.get_organizer_display }}</p>
                        <p><strong>Необходима сума:</strong> {{ donation.target_amount }} лв.</p>
                        <p><strong>Номер на сметка:</strong> {{ donation.iban }}</p>
                        <p><strong>Статус:</strong> {% if donation.is_expired %} Неактивна {% else %}
                            Активна  {% endif %}</p>
                        <p><strong>Крайна дата:</strong> {{ donation.to_date }}</p>
                        <p><strong>Телефон за връзка:</strong> {{ donation.contact_info }}</p>
                        <p><strong>Описание:</strong> {{ donation.description }}</p>
                    </div>
                    <div class="w3-container w3-padding-small w3-center">
                        {% if user.is_staff %}
                            <a href="{% url 'edit donation' donation.pk %}"
                               class="w3-button w3-round-large w3-teal w3-text-light-grey w3-hover-text-black w3-hover-teal w3-margin-small">Редактиране</a>
                            <a href="{% url 'delete donation' donation.pk %}"
                               class="w3-button w3-round-large w3-deep-orange w3-text-light-grey w3-hover-text-black w3-hover-deep-orange w3-margin-small">Изтриване</a>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="w3-text-grey">Няма налични каузи за дарение.</p>
    {% endif %}

{% endblock %}
